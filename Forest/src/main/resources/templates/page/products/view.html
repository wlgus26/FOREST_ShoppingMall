<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/default_layout}">


<th:block th:with="pageName='productView'"></th:block>      

<th:block layout:fragment="css">
    <!--    <link rel="stylesheet" th:href="@{/css/page/home.css}" >-->
	<style>
	.table > th {
		width: 25%;
	}
	
	.ck.ck-editor {
		width: 600px;
		max-width: 650px;
	}

	.ck-editor__editable {
		height: 50vh;
	}
	
	.editor img {
		max-width: 650px;
		height: auto;
	}
	
	/* 서브메뉴바 */
	.sub-menu1 {
	  background-color: #f0f0f0;
	  /* padding: 1px; */
	  margin-top: 15px;
	}
	
	.sub-menu1 ul {
	  list-style: none;
	  padding: 10px;
	  display: flex; /* Flexbox 사용 */
	  justify-content: space-around; /* 각 항목을 가능한 넓게 펼치기 */
	}
	
	.sub-menu1 li {
	  font-weight: bold;
	}
	
	.sub-menu1 a {
	  flex: 1; /* 너비를 같게 설정 */
	  text-align: center;
	  padding: 1px; /* 내부 여백 설정 */
	  text-decoration: none; /* 링크 밑줄 제거 */
	  color: #333; /* 링크 텍스트 색상 설정 */
	}
	
	.sub-menu1 a:last-child {
	  border-right: none; /* 마지막 항목의 구분선 제거 */
	}
	
	/* 페이지에 맞게 메뉴바 text bold 활성화 */
	.sub-menu1 a.active-menu {
	    font-weight: bold;
	    text-decoration: underline;
	}
	</style>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
 
</th:block>
<!-- view.html 고유 스크립트 추가 -->
<th:block layout:fragment="script">
	<script src="https://kit.fontawesome.com/51db22a717.js" crossorigin="anonymous"></script>
	 
	<!-- Bootstrap JS 및 jQuery -->
	<script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
</th:block>

<!-- Content -->

<div layout:fragment="content">
	<form >
	<input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
		<div class="container" style="width: 80%">
			
			<div class="row"><h1 class="page-header" style="text-align: center; margin-bottom: 50px;" th:text="${products.no}"></h1>
			<input type="hidden" value="${products.no}" id="productNo">
			</div>
			<div class="row" style="float: left; text-align: center; width:35%;">
				<img th:src="@{/static/upload/product/} + ${products.image}" style="width: 500px; height: 500px; overflow: hidden; object-fit: cover;">
			</div>
	
			<div class="row productInfo" style="width: 40%;" >
				<div class="form-group" style="text-align: center;">
					<h3 class="page-header" style="text-align: left;" th:text="${products.name}"></h3>
				</div>
				<div class="form-group" style="text-align: left;">
					<label>가격 : </label><span>&nbsp; <fmt:formatNumber th:text="${products.price}" type="number"/></span><span>&nbsp;원</span>
					<input type="hidden" value="${products.price}" id="price">
				</div>
				<div class="form-group" style="text-align: left;">
					<label>배송비 : </label><span>&nbsp;2500원</span>
					<p>도서산간지역 배송비 5000원 / 3만원 이상 결제시 무료배송</p>
				</div>
				
				<!-- 
				<div class="form-group" style="text-align: left;">
					<label>적립금 : </label><span><fmt:parseNumber var="test" value="${productInfo.price / 100}" integerOnly="true"/> ${test}&nbsp;원</span>
				</div>
				 -->
	
				<div class="form-horizontal" style="text-align: left;">
				    <label>옵션 : </label>
				    <select id="selectedOpt" class="form-control opt_select" name="selectedOpt">
				    	<option value="" selected>--- 선택 ---</option>
				        <option value="S">F</option>
				        <option value="S">S</option>
				        <option value="M">M</option>
				        <option value="L">L</option>
				    </select>
				</div>
			
				<div class="form-horizontal" style="text-align: left;">
				    <label for="select_count">구매수량 : </label>
				    <input type="number" class="form-control" id="select_count" name="orderQuantity" min="1" value="1">
				</div>
				<hr>
				<div class="row">
					<div class="selected_option" style="text-align: right;"></div>
					<div style="text-align: center;">
						<button id="btnOrder" class="btn btn-default" >주문하기</button>
						<button id="btnCart" class="btn btn-default btn-cart">장바구니</button>
		  			</div>
				</div>		
				<hr>	
			</div>
		</div>
	</form>	

	
		<br><br><br><br><br><br><br>
		
		<!-- With this -->
		<div class="sub-menu1">
		    <ul>
		        <li><a href="#">상품상세</a></li>
		        <li><a href="#">리뷰</a></li>
		        <li><a href="#">상품문의</a></li>
		    </ul>
		</div>



<!-- 장바구니, 주문하기 버튼 관련 함수-->
<script th:inline="javascript"> 

	var loginMember = [[${loginMember}]];
	var select = document.getElementById("selectedOpt");
	var selectedOpt = select.options[select.selectedIndex].value;
	
	// 장바구니 버튼
    $('#btnCart').on('click', (event) => {
        event.preventDefault(); // 버튼의 기본 동작 중지 
		
        console.log('옵션:' + selectedOpt);
        // 장바구니 버튼 클릭 시, 로그인 여부 체크 
        if(loginMember != null){
        	if(selectedOpt == ""){
        		
        		alert('옵션을 선택해 주세요');
        	} else if(selectedOpt != "") {
        		// cart테이블에 insert 로직 수행 . 
        		// insert 성공시
        		console.log(selectedOpt);
        		if (confirm('장바구니에 상품을 담았습니다. 장바구니로 이동하시겠습니까?')) {
                window.location.href = '/myPage/cart';
            	}        		
        	}     	 
        } else {
			if (confirm('로그인이 필요한 서비스입니다. 로그인 하시겠습니까?')) {
			       window.location.href = '/login';
			} 
        }
    });
	
 	// 주문하기 버튼
    $('#btnOrder').on('click', (event) => {
        event.preventDefault(); 
        var loginMember = [[${loginMember}]]; 
        
        // 주문하기 버튼 클릭 시, 로그인 여부 체크 
        if(loginMember == null){
             if (confirm('로그인이 필요한 서비스입니다. 로그인 하시겠습니까?')) {
                window.location.href = '/login';
             } 
        } else {
            /*
            	여기에 결제페이지로 이동할 코드 작성
            	ex. window.location.href = '/login';
            */ 
        }
    });
</script>



<!-- CKEditor  -->
<script src="https://ckeditor.com/apps/ckfinder/3.5.0/ckfinder.js"></script>
<script>		
//	ClassicEditor
//	.create(document.querySelector('.editor'))
//	.then(editor => {
//		console.log('Editor was initialized');	
//	})
//	.catch(error => {
//		console.error(error);
//	});
</script>

</div>
</html>